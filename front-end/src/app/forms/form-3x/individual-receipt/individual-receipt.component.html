<ng-template #rt let-r="result" let-t="term">
  <ngb-highlight [result]="formatTypeaheadItem(r)" [term]="t"></ngb-highlight>
</ng-template>
<ng-template #rtOrg let-r="result" let-t="term">
  <ngb-highlight [result]="formatTypeaheadOrgItem(r)" [term]="t"></ngb-highlight>
</ng-template>
<ng-template #rtCommitteeId let-r="result" let-t="term">
  <ngb-highlight [result]="formatTypeaheadCommitteeId(r)" [term]="t"></ngb-highlight>
</ng-template>
<ng-template #rtCandidateId let-r="result" let-t="term">
  <ngb-highlight [result]="formatTypeaheadCandidateId(r)" [term]="t"></ngb-highlight>
</ng-template>
<ng-template #rtCommitteeName let-r="result" let-t="term">
    <ngb-highlight [result]="formatTypeaheadCommitteeName(r)" [term]="t"></ngb-highlight>
</ng-template>
<ng-template #rtCandidate let-r="result" let-t="term">
  <ngb-highlight [result]="formatTypeaheadCandidate(r)" [term]="t"></ngb-highlight>
</ng-template>
<div class="individual-receipt-container">
  <form [formGroup]="frmIndividualReceipt">
    <header>
      <div class="header-content">
        <div class="float-left">
          <h2>
            Form 3X
            <ng-container *ngIf="transactionTypeText && !mainTransactionTypeText"> / {{ transactionTypeText }} </ng-container>
            <ng-container *ngIf="transactionTypeText && mainTransactionTypeText"> / 
              {{ mainTransactionTypeText }} / {{ transactionTypeText }}
            </ng-container>
            <!-- TODO - the transaction type check in next two lines is temporary. Once the cache issue is fixed remove the second 'and' claus -->
            <ng-container *ngIf="reattributionTransactionId && transactionType !== 'CONT_TO_CAN'"> (Reattribution)</ng-container> 
            <ng-container *ngIf="redesignationTransactionId && transactionType === 'CONT_TO_CAN'"> (Redesignation)</ng-container>
            <ng-container *ngIf="scheduleAction === editScheduleAction && !cloned"> / Edit </ng-container>
            <ng-container *ngIf="scheduleAction === editScheduleAction && cloned"> / Clone </ng-container>
            <ng-container *ngIf="scheduleAction === viewScheduleAction"> / View </ng-container>
          </h2>
        </div>
        <div class="float-right" ngbDropdown>
          <button type="button" class="btn btn-link btn-options" id="dropdownBasic2" ngbDropdownToggle>
            <span class="ellipsis-icon" aria-hidden="true"></span>
            <span class="sr-only">Click for more options</span>
          </button>
          <div ngbDropdownMenu aria-labelledby="dropdownBasic1">
            <button class="dropdown-item" (click)="printCurrentTransaction()"><i class="print-icon"></i> Print</button>
            <button class="dropdown-item" (click)="ImportTransactions()">
              <i class="file-import-icon" ></i> Import
            </button>
            <button class="dropdown-item" *ngIf="isShowForceAggregate()" (click)="toggleAggregation()">
              <i class="calculator-icon" >{{isAggregate?' Un-Aggregate':' Aggregate'}}</i>
            </button>
          </div>
        </div>
      </div>
      <div class="row">
        <div class="col-md-12">
          <hr />
        </div>
      </div>
    </header>

    <section class ="paragraph">
      <ng-container *ngFor="let hiddenField of hiddenFields">
        <input type="hidden" [name]="hiddenField?.name" [value]="hiddenField?.value" />
      </ng-container>
        <ng-container *ngFor="let row of formFields; let i = index">
          <ng-container *ngIf="titles[i]?.fieldset">
            <div class="subtitle-indv">
              <div [class]="titles[i]?.colClassName">
                {{ titles[i]?.label }}
              </div>
            </div>
          </ng-container>
          <div class="row" *ngIf="row.cols">
            <ng-container *ngIf="row.cols | isArray">
              <ng-container *ngFor="let col of row.cols">
                <div [class]="row.colClassName" *ngIf="isToggleShow(col)">
                  <div class="form-group" [style.width]="setSelectTypeWidth(col)">
                    <label [for]="col?.name"
                    *ngIf="col?.name !== 'election_other_description'"
                    >
                      {{ col?.text }}
                      <!-- replace button with div below to resolve tab issue into button -->
                      <!-- <button type="button" class="btn btn-info" ngbTooltip="{{ col?.infoText }}"
                        tooltipClass="form-tooltip" *ngIf="col?.infoIcon">
                        <i class="info-icon" aria-hidden="true"></i>
                        <span class="sr-only">Click here for more information</span>
                      </button> -->
                      <div type="button" class="btn btn-info" ngbTooltip="{{ col?.infoText }}"
                        tooltipClass="form-tooltip" *ngIf="col?.infoIcon">
                        <i class="info-icon" aria-hidden="true"></i>
                        <span class="sr-only">Click here for more information</span>
                      </div>
                      <ng-container *ngIf="!col?.validation?.required
                        && !col?.isReadonly && col?.name !== 'activity_event_identifier'">
                        <ng-container *ngIf="!(col?.name === 'purpose_description'
                          && (this.transactionType === 'RET_REC' || this.transactionType === 'PARTY_RET' || this.transactionType === 'PAC_RET'))">
                          (Optional)
                        </ng-container>
                      </ng-container>
                    </label>
                    <label
                    *ngIf="col?.name === 'election_other_description' && frmIndividualReceipt?.get('election_code')?.value  === 'O'"
                    >
                      {{ col?.text }}
                      <!-- replace button with div below to resolve tab issue into button -->
                      <!-- <button type="button" class="btn btn-info" ngbTooltip="{{ col?.infoText }}"
                        tooltipClass="form-tooltip" *ngIf="col?.infoIcon">
                        <i class="info-icon" aria-hidden="true"></i>
                        <span class="sr-only">Click here for more information</span>
                      </button> -->
                      <div type="button" class="btn btn-info" ngbTooltip="{{ col?.infoText }}"
                        tooltipClass="form-tooltip" *ngIf="col?.infoIcon">
                        <i class="info-icon" aria-hidden="true"></i>
                        <span class="sr-only">Click here for more information</span>
                      </div>
                      <ng-container *ngIf="!col?.validation?.required 
                        && !col?.isReadonly && col?.name !== 'activity_event_identifier'">
                        (Optional)
                      </ng-container>
                    </label>
                    <ng-container *ngIf="col?.type === 'text' || col?.type === 'date'">
                      <div [ngClass]="{ 'input-group': col?.inputGroup }">
                        <ng-container *ngIf="col?.inputGroup">
                          <div class="input-group-prepend">
                            <span class="input-group-text">
                              <i *ngIf="col?.inputIcon" [class]="col?.inputIcon" aria-hidden="true"></i>
                              <span *ngIf="col?.preText">{{col?.preText}}</span>
                            </span>
                          </div>
                        </ng-container>
                        <!-- [attr.readonly]="isReadOnly(col?.name, col.type)" -->
                        <!-- && col?.name !== 'child*entity_name'
                          && col?.name !== 'child*donor_cmte_id'" -->
                          <!-- (blur)="(isFieldName(col?.name, 'contribution_amount') || isFieldName(col?.name, 'expenditure_amount')) 
                                    ? contributionAmountChange($event, col?.name, col?.validation?.dollarAmountNegative) : populatePurpose(col?.name)" -->
                        <!-- [attr.readonly]="(col.type === 'text' && col?.isReadonly) || isTotalAmountReadOnly(col) ?  true : null"                                     -->
                        <input *ngIf="col?.name !== 'first_name' 
                                && col?.name !== 'last_name'
                                && !isFieldName(col?.name, 'cand_first_name')
                                && !isFieldName(col?.name, 'cand_last_name')
                                && !isFieldName(col?.name, 'entity_name')
                                && !isFieldName(col?.name, 'donor_cmte_id')
                                && !isFieldName(col?.name, 'donor_cmte_name')
                                && !isFieldName(col?.name, 'beneficiary_cmte_id')
                                && !isFieldName(col?.name, 'beneficiary_cmte_name') 
                                && !isFieldName(col?.name, 'beneficiary_cand_id') 
                                && !isFieldName(col?.name, 'prefix')
                                && !isFieldName(col?.name, 'suffix')
                                && !isFieldName(col?.name, 'election_other_description')
                                && !isFieldName(col?.name, 'election_year')
                                " class="form-control" [style.width]="col?.width" [style.height]="col?.height"
                          [attr.type]="col?.type" [attr.name]="col?.name"
                          [attr.readonly]="isFieldReadOnly(col)"
                          [attr.value]="col?.value"
                          [maxlength]="(isFieldName(col?.name, 'contribution_amount') || isFieldName(col?.name, 'expenditure_amount') 
                                        || isFieldName(col?.name, 'contribution_aggregate'))? col?.validation?.max + 5: col?.validation?.max"
                          [formControlName]="col?.name"
                          (blur)="handleOnBlurEvent($event, col)"    
                          [ngClass]="
                              frmIndividualReceipt.get(col?.name)?.invalid &&
                              (frmIndividualReceipt.touched || frmIndividualReceipt.dirty)
                                ? 'input-field-error'
                                : ''
                            " (keyup)="handleFormFieldKeyup($event, col)" (change)="(isFieldName(col?.name, 'contribution_date') || isFieldName(col?.name, 'expenditure_date')) 
                                      ? dateChange(col?.name) : null;" />
                        <input *ngIf="col?.name === 'last_name'" class="form-control" [style.width]="col?.width"
                          [style.height]="col?.height" [attr.type]="col?.type" [attr.name]="col?.name"
                          [attr.value]="col?.value" [maxlength]="col?.validation?.max" [formControlName]="col?.name"
                          [attr.readonly]="isFieldReadOnly(col)"
                          [ngClass]="
                              frmIndividualReceipt.get(col?.name)?.invalid &&
                              (frmIndividualReceipt.touched || frmIndividualReceipt.dirty)
                                ? 'input-field-error'
                                : ''
                            " id="typeahead-template-last-name" [ngbTypeahead]="searchLastName" [focusFirst]=false
                          [resultTemplate]="rt" [inputFormatter]="formatterLastName"
                          (selectItem)="handleSelectedIndividual($event, col)" (keyup)="handleFormFieldKeyup($event, col)"
                          (blur)="populatePurpose(col?.name)" />
                        <input *ngIf="col?.name === 'first_name'" class="form-control" [style.width]="col?.width"
                          [style.height]="col?.height" [attr.type]="col?.type" [attr.name]="col?.name"
                          [attr.value]="col?.value" [maxlength]="col?.validation?.max" [formControlName]="col?.name"
                          [attr.readonly]="isFieldReadOnly(col)"
                          [ngClass]="
                              frmIndividualReceipt.get(col?.name)?.invalid &&
                              (frmIndividualReceipt.touched || frmIndividualReceipt.dirty)
                                ? 'input-field-error'
                                : ''
                            " id="typeahead-template-first-name" [ngbTypeahead]="searchFirstName" [focusFirst]=false
                          [resultTemplate]="rt" [inputFormatter]="formatterFirstName"
                          (selectItem)="handleSelectedIndividual($event, col)" (keyup)="handleFormFieldKeyup($event, col)"
                          (blur)="populatePurpose(col?.name)" />
                        <input *ngIf="col?.name === 'prefix'" class="form-control" [style.width]="col?.width"
                          [style.height]="col?.height" [attr.type]="col?.type" [attr.name]="col?.name"
                          [attr.value]="col?.value" [maxlength]="col?.validation?.max" [formControlName]="col?.name"
                          [attr.readonly]="isFieldReadOnly(col)"
                          [ngClass]="
                              frmIndividualReceipt.get(col?.name)?.invalid &&
                              (frmIndividualReceipt.touched || frmIndividualReceipt.dirty)
                                ? 'input-field-error'
                                : ''
                            " id="typeahead-template-prefix" [ngbTypeahead]="searchPrefix" [focusFirst]=false
                          [resultTemplate]="rt" [inputFormatter]="formatterPrefix"
                          (selectItem)="handleSelectedIndividual($event, col)" (keyup)="handleFormFieldKeyup($event, col)"
                          (blur)="populatePurpose(col?.name)" />
                        <input *ngIf="col?.name === 'suffix'" class="form-control" [style.width]="col?.width"
                          [style.height]="col?.height" [attr.type]="col?.type" [attr.name]="col?.name"
                          [attr.value]="col?.value" [maxlength]="col?.validation?.max" [formControlName]="col?.name"
                          [attr.readonly]="isFieldReadOnly(col)"
                          [ngClass]="
                              frmIndividualReceipt.get(col?.name)?.invalid &&
                              (frmIndividualReceipt.touched || frmIndividualReceipt.dirty)
                                ? 'input-field-error'
                                : ''
                            " id="typeahead-template-suffix" [ngbTypeahead]="searchSuffix" [focusFirst]=false
                          [resultTemplate]="rt" [inputFormatter]="formatterSuffix"
                          (selectItem)="handleSelectedIndividual($event, col)" (keyup)="handleFormFieldKeyup($event, col)"
                          (blur)="populatePurpose(col?.name)" />
                        <input *ngIf="isFieldName(col?.name, 'cand_last_name')" class="form-control"
                          [style.width]="col?.width" [style.height]="col?.height" [attr.type]="col?.type"
                          [attr.name]="col?.name" [attr.value]="col?.value" [maxlength]="col?.validation?.max"
                          [formControlName]="col?.name" [ngClass]="
                              frmIndividualReceipt.get(col?.name)?.invalid &&
                              (frmIndividualReceipt.touched || frmIndividualReceipt.dirty)
                                ? 'input-field-error'
                                : ''
                            " id="typeahead-template-cand-last-name" [ngbTypeahead]="searchCandLastName" [focusFirst]=false
                          [resultTemplate]="rtCandidate" [inputFormatter]="formatterCandLastName"
                          (selectItem)="handleSelectedCandidate($event, col)" (keyup)="handleFormFieldKeyup($event, col)"
                          (blur)="populatePurpose(col?.name)" />
                        <input *ngIf="isFieldName(col?.name, 'cand_first_name')" class="form-control"
                          [style.width]="col?.width" [style.height]="col?.height" [attr.type]="col?.type"
                          [attr.name]="col?.name" [attr.value]="col?.value" [maxlength]="col?.validation?.max"
                          [formControlName]="col?.name" [ngClass]="
                              frmIndividualReceipt.get(col?.name)?.invalid &&
                              (frmIndividualReceipt.touched || frmIndividualReceipt.dirty)
                                ? 'input-field-error'
                                : ''
                            " id="typeahead-template-cand-first-name" [ngbTypeahead]="searchCandFirstName"
                          [focusFirst]=false [resultTemplate]="rtCandidate" [inputFormatter]="formatterCandFirstName"
                          (selectItem)="handleSelectedCandidate($event, col)" (keyup)="handleFormFieldKeyup($event, col)"
                          (blur)="populatePurpose(col?.name)" />
                        <input *ngIf="isFieldName(col?.name, 'entity_name')" class="form-control" [style.width]="col?.width"
                          [style.height]="col?.height" [attr.type]="col?.type" [attr.name]="col?.name"
                          [attr.value]="col?.value" [maxlength]="col?.validation?.max" [formControlName]="col?.name"
                          [ngClass]="
                              frmIndividualReceipt.get(col?.name)?.invalid &&
                              (frmIndividualReceipt.touched || frmIndividualReceipt.dirty)
                                ? 'input-field-error'
                                : ''
                            " id="typeahead-template-org" [ngbTypeahead]="searchOrg" [focusFirst]=false
                          [resultTemplate]="rtOrg" [inputFormatter]="formatterOrgName"
                          (selectItem)="handleSelectedOrg($event, col)" (keyup)="handleFormFieldKeyup($event, col)" 
                          [attr.readonly]="isFieldReadOnly(col)" />
                        <input *ngIf="isFieldName(col?.name, 'donor_cmte_id') ||
                                  isFieldName(col?.name, 'beneficiary_cmte_id') ||
                                  isFieldName(col?.name, 'beneficiary_cand_id')" class="form-control"
                          [style.width]="col?.width" [style.height]="col?.height" [attr.type]="col?.type"
                          [attr.name]="col?.name" [attr.value]="col?.value" [maxlength]="col?.validation?.max"
                          [formControlName]="col?.name" [ngClass]="
                              frmIndividualReceipt.get(col?.name)?.invalid &&
                              (frmIndividualReceipt.touched || frmIndividualReceipt.dirty)
                                ? 'input-field-error'
                                : ''
                            " id="typeahead-template-committee-id" 
                          [ngbTypeahead]="isFieldName(col?.name, 'beneficiary_cand_id') ? searchCandidateId : searchCommitteeId" 
                          [focusFirst]=false
                          [resultTemplate]="isFieldName(col?.name, 'beneficiary_cand_id') ? rtCandidateId : rtCommitteeId" 
                          [inputFormatter]="isFieldName(col?.name, 'beneficiary_cand_id') ? formatterCandidateId: formatterCommitteeId"
                          (selectItem)="handleSelectedOrg($event, col)" (keyup)="handleFormFieldKeyup($event, col)" />
                        <input *ngIf="isFieldName(col?.name, 'donor_cmte_name') ||
                                  isFieldName(col?.name, 'beneficiary_cmte_name')" class="form-control"
                          [style.width]="col?.width" [style.height]="col?.height" [attr.type]="col?.type"
                          [attr.name]="col?.name" [attr.value]="col?.value" [maxlength]="col?.validation?.max"
                          [formControlName]="col?.name" [ngClass]="
                              frmIndividualReceipt.get(col?.name)?.invalid &&
                              (frmIndividualReceipt.touched || frmIndividualReceipt.dirty)
                                ? 'input-field-error'
                                : ''
                            " id="typeahead-template-committee-name" [ngbTypeahead]="searchCommitteeName"
                          [focusFirst]=false [resultTemplate]="rtCommitteeName" [inputFormatter]="formatterCommitteeName"
                          (selectItem)="handleSelectedOrg($event, col)" (keyup)="handleFormFieldKeyup($event, col)" />
                      </div>
                      <input *ngIf="isFieldName(col?.name, 'election_other_description') && frmIndividualReceipt?.get('election_code')?.value  === 'O'"
                                class="form-control" [style.width]="col?.width" [style.height]="col?.height"
                          [attr.type]="col?.type" [attr.name]="col?.name"
                          [attr.value]="col?.value"
                          [maxlength]="col?.validation?.max"
                          [formControlName]="col?.name"
                          [attr.disabled]="isSelectFieldReadOnly(col)"
                          [ngClass]="
                              frmIndividualReceipt.get(col?.name)?.invalid &&
                              (frmIndividualReceipt.touched || frmIndividualReceipt.dirty)
                                ? 'input-field-error'
                                : ''" />
                      <input *ngIf="isFieldName(col?.name, 'election_year')"
                                class="form-control" [style.width]="col?.width" [style.height]="col?.height"
                          [attr.type]="col?.type" [attr.name]="col?.name"
                          [attr.value]="col?.value"
                          [maxlength]="col?.validation?.max"
                          [formControlName]="col?.name"
                          [attr.disabled]="isSelectFieldReadOnly(col)"
                          placeholder="YYYY"
                          [ngClass]="
                              frmIndividualReceipt.get(col?.name)?.invalid &&
                              (frmIndividualReceipt.touched || frmIndividualReceipt.dirty)
                                ? 'input-field-error'
                                : ''" />
                      <div class="error-text" *ngIf="
                            (frmIndividualReceipt.touched || frmIndividualReceipt.dirty) &&
                            frmIndividualReceipt.get(col?.name).invalid
                          ">
                        <ng-container *ngIf="frmIndividualReceipt.get(col?.name).errors?.maxlength">
                          <div class="text-error text-left" *ngIf="
                                frmIndividualReceipt.get(col?.name).errors.maxlength?.requiredLength <
                                frmIndividualReceipt.get(col?.name).errors.maxlength?.actualLength
                              ">
                            Only {{ frmIndividualReceipt.get(col?.name).errors.maxlength?.requiredLength }} characters
                            allowed.
                          </div>
                        </ng-container>
                        <ng-container *ngIf="frmIndividualReceipt.get(col?.name).errors">
                          <div class="text-error text-left"
                            *ngIf="frmIndividualReceipt.get(col?.name).errors?.nonValidAmount">
                            Please enter a valid amount.
                          </div>
                        </ng-container>
                        <ng-container *ngIf="frmIndividualReceipt.get(col?.name).errors">
                          <div class="text-error text-left"
                            *ngIf="frmIndividualReceipt.get(col?.name).errors?.nonAlphaNumeric">
                            Alphanumeric characters only.
                          </div>
                        </ng-container>
                        <ng-container *ngIf="frmIndividualReceipt.get(col?.name).errors">
                          <div class="text-error text-left"
                            *ngIf="frmIndividualReceipt.get(col?.name).errors?.nonFloatingPoint">
                            Only numerical values are allowed.
                          </div>
                        </ng-container>
                        <ng-container *ngIf="frmIndividualReceipt.get(col?.name).errors">
                          <div class="text-error text-left"
                            *ngIf="frmIndividualReceipt.get(col?.name).errors?.contributionDateInvalid">
                            The date entered falls outside of the report coverage period. Transactions for this report
                            should fall within {{ cvgStartDate }} and {{ cvgEndDate }} (Coverage Dates of Report). If you
                            need to add a transaction with a date that falls outside of the coverage period for this report,
                            you will need to check the memo code box.
                            <!-- Entered date is outside of the report coverage period. Please enter transactions for this
                              coverage period only. -->
                          </div>
                        </ng-container>
                        <ng-container *ngIf="frmIndividualReceipt.get(col?.name).errors">
                          <div class="text-error text-left"
                            *ngIf="frmIndividualReceipt.get(col?.name).errors?.reportFiled">
                            The report corresponding to this date is already filed. You must amend the report first.
                            <!-- Entered date is outside of the report coverage period. Please enter transactions for this
                              coverage period only. -->
                          </div>
                        </ng-container>
                        <ng-container *ngIf="frmIndividualReceipt.get(col?.name).errors">
                          <div class="text-error text-left"
                            *ngIf="frmIndividualReceipt.get(col?.name).errors?.reportNotFound">
                            No report corresponding to this date found.
                          </div>
                        </ng-container>
                        <ng-container *ngIf="frmIndividualReceipt.get(col?.name).errors">
                          <div class="text-error text-left"
                            *ngIf="frmIndividualReceipt.get(col?.name).errors?.amountExceeded">
                            <ng-container *ngIf="!reattributionTransactionId && !redesignationTransactionId">Expenditure amount exceeds outstanding debt amount</ng-container>
                            <ng-container *ngIf="reattributionTransactionId || redesignationTransactionId">Amount must be less than the total amount on original transaction</ng-container>
                          </div>
                        </ng-container>
                      </div>
                    </ng-container>
                    <ng-container *ngIf="col?.type === 'checkbox'">
                      <!-- [attr.disabled]="isMemoCodeReadOnly(col?.name)" -->
                      <input class="form-control forms__big_checkbox" [style.width]="col?.width"
                        [style.height]="col?.height" [attr.type]="col?.type" [attr.name]="col?.name"
                        [attr.value]="col?.value"
                        [checked]="isFieldName(col?.name, 'memo_code') ? checkForMemoCode(col?.name) : null"
                        [formControlName]="col?.name"
                        (change)="isFieldName(col?.name, 'memo_code') ? memoCodeChange($event, col?.name) : null" [ngClass]="
                            frmIndividualReceipt.get(col?.name)?.invalid &&
                            (frmIndividualReceipt.touched || frmIndividualReceipt.dirty)
                              ? 'input-field-error'
                              : ''
                          " />
                    </ng-container>
                    <ng-container *ngIf="col?.type === 'textarea'">
                      <textarea [style.height]="col?.height" [style.width]="col?.width"
                        [style.overflow]="col.scroll ? col.scroll : null" [attr.name]="col?.name"
                        [attr.maxlength]="col?.validation?.max" [formControlName]="col?.name"></textarea>
                    </ng-container>
                    <ng-container *ngIf="col?.type === 'select' && isFieldName(col?.name, 'cand_office')">
                      <ng-select #candOfficeTypeSelect 
                        [items]="candidateOfficeTypes"
                        (change)="handleCandOfficeChange($event, col)" 
                        class="forms__select" 
                        [formControlName]="col?.name"
                        bindValue="code" 
                        bindLabel="name"
                        [selectOnTab]="true"
                        [ngClass]="
                            frmIndividualReceipt.get(col?.name)?.invalid &&
                            (frmIndividualReceipt.touched || frmIndividualReceipt.dirty)
                              ? 'forms__select-error'
                              : ''
                          ">
                      </ng-select>
                    </ng-container>
                    <ng-container *ngIf="col?.type === 'select' && 
                          (isFieldName(col?.name, 'state') ||
                          isFieldName(col?.name, 'cand_office_state'))">
                      <ng-select #stateSelect 
                        [items]="states" 
                        (change)="handleStateChange($event, col)"
                        class="forms__select" 
                        [formControlName]="col?.name" 
                        bindValue="code" 
                        bindLabel="code" 
                        [selectOnTab]="true"
                        [attr.readonly]="isSelectFieldReadOnly(col)"
                        [ngClass]="
                            frmIndividualReceipt.get(col?.name)?.invalid &&
                            (frmIndividualReceipt.touched || frmIndividualReceipt.dirty)
                              ? 'forms__select-error'
                              : ''
                          ">
                        <ng-template ng-option-tmp let-item="item" let-search="searchTerm" let-index="index">
                          <span>{{ item.code + ' - ' + item.name }}</span>
                        </ng-template>
                      </ng-select>
                    </ng-container>
                    <ng-container *ngIf="col?.type === 'select' && isFieldName(col?.name, 'election_code')">
                      <ng-select #electionCodeSelect 
                        [items]="electionTypes"
                        (change)="handleElectionCodeChange($event, col)" 
                        class="forms__select election-code-select"
                        [formControlName]="col?.name" 
                        bindValue="electionType" 
                        bindLabel="electionTypeDescription"
                        [selectOnTab]="true"
                        [ngClass]="
                            frmIndividualReceipt.get(col?.name)?.invalid &&
                            (frmIndividualReceipt.touched || frmIndividualReceipt.dirty)
                              ? 'forms__select-error'
                              : ''
                          ">
                      </ng-select>
                    </ng-container>
                    <ng-container *ngIf="col?.type === 'select' && isFieldName(col?.name, 'entity_type')">
                      <ng-select #entityTypeSelect 
                        [items]="entityTypes" 
                        (change)="handleEntityTypeChange($event)"
                        class="forms__select entity-type-select" 
                        [formControlName]="col?.name" 
                        bindValue="entityType"
                        bindLabel="entityTypeDescription" 
                        [selectOnTab]="true"
                        [readonly]="isSelectFieldReadOnly(col)"
                        [ngClass]="
                            frmIndividualReceipt.get(col?.name)?.invalid &&
                            (frmIndividualReceipt.touched || frmIndividualReceipt.dirty)
                              ? 'forms__select-error'
                              : ''
                          ">
                      </ng-select>
                    </ng-container>
                    <ng-container *ngIf="col?.type === 'select' && isFieldName(col?.name, 'activity_event_type')">
                      <ng-select #activityEventTypeSelect 
                        [items]="activityEventTypes" 
                        (change)="handleActivityEventTypeChange($event, col)"
                        class="forms__select activity-event-type-select" 
                        [formControlName]="col?.name" 
                        bindValue="eventType"
                        bindLabel="eventTypeDescription" 
                        [selectOnTab]="true"
                        [readonly]="isSelectFieldReadOnly(col)"
                        [ngClass]="
                            frmIndividualReceipt.get(col?.name)?.invalid &&
                            (frmIndividualReceipt.touched || frmIndividualReceipt.dirty)
                              ? 'forms__select-error'
                              : ''
                          ">
                      </ng-select>                     
                    </ng-container>
                    <ng-container 
                      *ngIf="col?.type === 'select' && isFieldName(col?.name, 'activity_event_identifier')
                        && activityEventNames"
                    >
                    <!-- bindValue="activityEventDescription" -->
                    <!-- activityEventType -->
                      <ng-select #activityEventNameSelect 
                        [items]="activityEventNames"
                        (change)="handleActivityEventNameChange($event, col)" 
                        class="forms__select activity-event-name-select" 
                        [formControlName]="col?.name" 
                        bindValue="activityEventDescription"
                        bindLabel="activityEventDescription" 
                        [selectOnTab]="true"
                        [readonly]="isSelectFieldReadOnly(col)"
                        [ngClass]="
                            frmIndividualReceipt.get(col?.name)?.invalid &&
                            (frmIndividualReceipt.touched || frmIndividualReceipt.dirty)
                              ? 'forms__select-error'
                              : ''
                          ">
                      </ng-select>
                    </ng-container>                                         
                    <ng-container *ngIf="col?.type === 'select' && 
                          (isFieldName(col?.name, 'levin_account_id'))">
                      <ng-select #levinAccountSelect 
                        [items]="levinAccounts" 
                        class="forms__select" 
                        [formControlName]="col?.name" 
                        bindValue="levin_account_id" 
                        bindLabel="levin_account_name" 
                        [selectOnTab]="true"
                        [readonly]="isSelectFieldReadOnly(col)"
                        [ngClass]="
                            frmIndividualReceipt.get(col?.name)?.invalid &&
                            (frmIndividualReceipt.touched || frmIndividualReceipt.dirty)
                              ? 'forms__select-error'
                              : ''
                          ">
                      </ng-select>
                    </ng-container>
                  </div>
                </div>
              </ng-container>
              <!-- ./col -->
            </ng-container>
          </div>
          <!-- ./row -->
          <ng-container *ngIf="row.seperator">
            <div class="row">
              <div class="col-md-12">
                <hr />
              </div>
            </div>
          </ng-container>
          <ng-container *ngIf="row.childForm">
            <div class="row">
              <div [class]="row.colClassName">
                {{ row.childFormTitle }}
              </div>
            </div>
            <div class="row">
              <div class="col-md-12">
                <hr />
              </div>
            </div>
          </ng-container>
        </ng-container>
        <app-sub-transactions-table [hidden]="!isShowChildTransactions()" 
          [subTransactions]="subTransactions"
          [formType]="formType"
          [subTransactionsTableType]="subTransactionsTableType"
          [returnToDebtSummary]="returnToDebtSummary"
          [returnToDebtSummaryInfo]="returnToDebtSummaryInfo">
        </app-sub-transactions-table>
        <div class="forms__btn-container">
          <button id="addSingleChildButton" *ngIf="!subTransactionInfo?.isEarmark &&
                        subTransactionInfo?.isParent && !multipleSubTransactionInfo" 
            class="btn btn-primary btn-left"
            (click)="saveForAddSub()">
            <i class="plus-icon-circle" aria-hidden="true"></i>
            Add {{ subTransactionInfo.subTransactionTypeDescription }}
          </button>
          <button *ngIf="subTransactionInfo?.isParent && multipleSubTransactionInfo
              && multipleSubTransactionInfo?.length > 0 && transactionType === 'DEBT_BY_VENDOR'" 
            class="btn btn-primary btn-left"
            (click)="saveForAddMemoSub(multipleSubTransactionInfo[0])">
            <i class="plus-icon-circle" aria-hidden="true"></i>
            Make a Payment on Debt
          </button>          
          <div [ngStyle]="{'min-height': memoDropdownSize}" style="height: auto">
            <div *ngIf="subTransactionInfo?.isParent && multipleSubTransactionInfo
                && transactionType !== 'DEBT_BY_VENDOR'" 
              ngbDropdown class="d-inline-block"
              placement="bottom-left" (openChange)="multipleMemoDropdownChanged($event)">
              <button class="btn btn-primary dropdown-toggle" id="jfMemoDropdown" ngbDropdownToggle>
                <i class="plus-icon-circle" aria-hidden="true"></i>
                <ng-container 
                  *ngIf="
                    transactionType === 'DEBT_TO_VENDOR';
                    else jfTransferMemo">
                  Make a Payment on Debt
                </ng-container>
                <ng-template #jfTransferMemo>Add JF Transfer Memo</ng-template>
                <i class="dropdown-icon" aria-hidden="true"></i>
              </button>
              <div ngbDropdownMenu aria-labelledby="jfMemoDropdown" id="jfMemoDropdown-menu">
                <ng-container *ngFor="let jfMemo of multipleSubTransactionInfo">
                  <button ngbDropdownItem (click)="saveForAddMemoSub(jfMemo)">
                    {{jfMemo.subTransactionTypeDescription}}
                  </button>
                </ng-container>
              </div>
            </div>
          </div>
        </div>
      <!--</ng-container>-->
    </section>
    <footer>
      <footer>
        <div class="grid-row">
          <div class="grid-row__col grid-row__col--12">
            <div class="forms__btn-container">
              <div *ngIf="subTransactionInfo?.isEarmark === true; else allOtherTrx">   
                <!-- <div>The scheduleAction is {{scheduleAction}}</div>              -->                
                <ng-template *ngIf="scheduleAction === editScheduleAction; then editEarMarkTrx; else createEarMarkTrx">
                </ng-template>

                <ng-template #editEarMarkTrx>
                  <button class="btn btn-previous btn-left" type="button" (click)="cancelEditEarMarkTrx()">
                    Cancel
                  </button>
                  <button *ngIf="subTransactionInfo?.isParent" class="btn btn-primary btn-right"
                    (click)="saveForEditEarmark()">
                    Next
                  </button>
                  <button *ngIf="subTransactionInfo?.isParent === false"
                    class="btn btn-secondary btn-right" 
                    (click)="updateOnly()">
                    Save
                  </button>
                  <a *ngIf="subTransactionInfo?.isParent === false && !reattributionTransactionId" class="btn btn-primary btn-right"
                    (click)="saveAndReturnToParent()">
                    Return to {{ subTransactionInfo.transactionTypeDescription }}
                  </a>                  
                </ng-template>
                
                <ng-template #createEarMarkTrx>
                  <button *ngIf="!subTransactionInfo || subTransactionInfo?.isParent" class="btn btn-previous btn-left" type="button"
                    (click)="previousStep()">
                    Previous
                  </button>
                  <button *ngIf="subTransactionInfo?.isParent" class="btn btn-primary btn-right"
                    (click)="saveForAddEarmark()">
                    Next
                  </button>
                  <button *ngIf="subTransactionInfo?.isParent === false"
                    class="btn btn-secondary btn-right" (click)="saveAndReturnToNewParent()">
                    Save &amp; Add Transaction
                  </button>
                  <a *ngIf="subTransactionInfo?.isParent === false && !reattributionTransactionId" class="btn btn-primary btn-right"
                    (click)="saveAndReturnToParent()">
                    Return to {{ subTransactionInfo.transactionTypeDescription }}
                  </a>
                  <a *ngIf="scheduleAction === addScheduleAction" class="btn btn-previous btn-right" (click)="(frmIndividualReceipt.dirty) ? saveOrWarn() : viewTransactions()">
                    View Transactions
                  </a>
                </ng-template>
              </div>

              <ng-template #allOtherTrx>
                <div *ngIf="scheduleAction === editScheduleAction || reattributionTransactionId || redesignationTransactionId; else createActions">
                  <button *ngIf="!isShedH4OrH6TransactionType(transactionType) || cloned" class="btn btn-previous btn-left" type="button" (click)="cancel()">
                    Cancel
                  </button>
                  <button *ngIf="isShedH4OrH6TransactionType(transactionType) && !cloned" class="btn btn-previous btn-left" type="button" (click)="clearFormValues(); goH4OrH6Summary(transactionType)">
                    Cancel
                  </button>
                  <button class="btn btn-secondary btn-right" (click)="updateOnly()">
                    Save
                  </button>
                  <a *ngIf="subTransactionInfo?.isParent === false && !reattributionTransactionId" class="btn btn-primary btn-right"
                    (click)="saveAndReturnToParent()">
                    Return to {{ subTransactionInfo.transactionTypeDescription }}
                  </a>
                </div>
                <ng-template #createActions>
                  <div *ngIf="!isShedH4OrH6TransactionType(transactionType)">
                    <button *ngIf="(!subTransactionInfo || subTransactionInfo?.isParent) && (scheduleAction !== viewScheduleAction)" class="btn btn-previous btn-left" type="button"
                      (click)="previousStep()">
                      Previous
                    </button>
                    <button *ngIf="subTransactionInfo && subTransactionInfo.isParent === false && scheduleAction !== viewScheduleAction" class="btn btn-previous btn-left"
                      type="button" (click)="returnToParent(editScheduleAction)">
                      Cancel
                    </button>
                    <button *ngIf="scheduleAction !== viewScheduleAction" class="btn btn-secondary btn-right" (click)="saveOnly()">
                      Save &amp; Add Transaction
                    </button>
                    <div *ngIf="scheduleAction === viewScheduleAction">
                      <button type="button" class="btn btn-outline-dark btn-right" (click)="viewTransactions()">Close</button>
                    </div>
                    <a *ngIf="subTransactionInfo?.isParent === false && !reattributionTransactionId && scheduleAction !== viewScheduleAction" class="btn btn-primary btn-right"
                      (click)="saveAndReturnToParent()">
                      Save &amp; Return to {{ subTransactionInfo.transactionTypeDescription }}
                    </a>
                    <a *ngIf="scheduleAction === addScheduleAction" class="btn btn-previous btn-right" (click)="(frmIndividualReceipt.dirty) ? saveOrWarn() : viewTransactions()">
                      View Transactions
                    </a>
                  </div>
                  <div *ngIf="isShedH4OrH6TransactionType(transactionType)">
                    <button *ngIf="!subTransactionInfo || subTransactionInfo?.isParent" class="btn btn-previous btn-left" type="button"
                      (click)="previousStep()">
                      Previous
                    </button>
                    <button class="btn btn-secondary btn-right" (click)="saveOnly()">
                      Save and Add
                    </button>
                    <button class="btn btn-previous btn-right" (click)="saveForReturnToSummary()">
                      Summary
                    </button>
                  </div>
                </ng-template>
              </ng-template>
            </div>
          </div>
        </div>
      </footer>
    </footer>
  </form>
</div>
